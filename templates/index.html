<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>정치적 성향 테스트</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .test-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
        }

        .question-text {
            font-size: 16px;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .answer-options {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .answer-btn {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-align: center;
        }

        .answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .answer-btn.selected {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            transition: width 0.3s ease;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .answer-options {
                flex-direction: column;
            }
            
            .answer-btn {
                min-width: auto;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🗳️ 정치적 성향 테스트</h1>
            <p>14개의 질문에 답하여 당신의 정치적 좌표를 확인해보세요</p>
        </div>

        <div id="test-section" class="test-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            
            <div id="question-container"></div>
            
            <button id="submit-btn" class="submit-btn hidden" onclick="calculateResult()">
                결과 확인하기
            </button>
        </div>

        <div id="result-section" class="test-section hidden">
            <h2 style="text-align: center; margin-bottom: 20px;">당신의 정치적 성향</h2>
            <div id="compass-chart"></div>
            <div id="result-description"></div>
        </div>
    </div>

    <!-- Plotly.js 라이브러리 CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- 메인 JavaScript 코드 -->
    <script>
        // 질문 데이터 (이미지의 경제적 질문들 기반)
        const QUESTIONS_DATA = {
            economic: [
                { id: 1, text: "사람은 궁극적으로 자신이 속한 국가보다는 자신의 속한 계층(계급)에 따라 나뉜다.", weight: -1 }, // 계급의식 강조 = 좌파
                { id: 2, text: "물가 안정이 일자리 창출보다 더 중요하다.", weight: 1 }, // 긴축정책 선호 = 우파
                { id: 3, text: "기업들이 자발적으로 환경을 보호할 것이라고 믿기 어렵기 때문에 규제가 필요하다.", weight: -1 }, // 정부규제 지지 = 좌파
                { id: 4, text: "능력에 따라 일하고 필요에 따라 가진다는 것은 근본적으로 좋은 생각이다.", weight: -1 }, // 사회주의 이상 = 좌파
                { id: 5, text: "마시는 물처럼 생존에 필요한 기본적인 것까지 상품으로 팔리는 것은 비참한 현실이다.", weight: -1 }, // 기본권 상품화 반대 = 좌파
                { id: 6, text: "토지는 사거나 팔 수 있는 상품이 되어서는 안 된다.", weight: -1 }, // 토지 사유제 반대 = 좌파
                { id: 7, text: "사회에 아무런 기여를 하지 않으면서 단지 돈을 굴리는 방식으로 부를 축적하는 것은 바람직하지 않다.", weight: -1 }, // 금융자본 비판 = 좌파
                { id: 8, text: "보호무역이 필요한 경우도 있다.", weight: -0.5 }, // 정부개입 선호, 약한 좌파
                { id: 9, text: "기업의 유일한 사회적 책임은 이익을 남겨 주주들에게 나누어 주는 것이다.", weight: 1 }, // 신자유주의 = 우파
                { id: 10, text: "부자들은 현재 너무 많은 세금을 내고 있다.", weight: 1 }, // 감세 지지 = 우파
                { id: 11, text: "지불 능력이 있는 사람들은 더 높은 수준의 의료 서비스를 받을 권리가 있다.", weight: 1 }, // 의료 시장화 = 우파
                { id: 12, text: "정부는 공공의 이익을 침해하면서 이윤을 추구하는 기업을 처벌해야 한다.", weight: -1 }, // 기업규제 지지 = 좌파
                { id: 13, text: "독점을 하려는 약탈적 다국적기업을 규제해야 진정한 의미의 자유시장이 구현될 수 있다.", weight: -0.5 }, // 독점규제 = 약한 좌파
                { id: 14, text: "시장이 자유로울수록, 사람들도 더욱 자유로워진다.", weight: 1 } // 자유시장 신봉 = 우파
            ],
            social: [
                { id: 15, text: "사형제도는 범죄 억제에 효과적이므로 유지되어야 한다.", weight: 1 }, // 권위주의
                { id: 16, text: "전통적인 가족 가치를 보호하는 것이 사회 안정에 중요하다.", weight: 1 }, // 권위주의  
                { id: 17, text: "국가 안보를 위해서라면 개인의 사생활이 어느 정도 감시받는 것은 불가피하다.", weight: 1 }, // 권위주의
                { id: 18, text: "마리화나 같은 soft drug은 개인의 선택이므로 합법화되어야 한다.", weight: -1 }, // 자유주의
                { id: 19, text: "동성 커플도 이성 커플과 동등한 결혼 권리를 가져야 한다.", weight: -1 }, // 자유주의
                { id: 20, text: "낙태는 여성의 몸에 관한 선택권이므로 보장되어야 한다.", weight: -1 }, // 자유주의
                { id: 21, text: "이민자들은 우리나라의 문화와 가치에 완전히 동화되어야 한다.", weight: 1 }, // 권위주의
                { id: 22, text: "학교에서는 국가에 대한 충성심과 애국심을 가르쳐야 한다.", weight: 1 }, // 권위주의
                { id: 23, text: "종교적 신념보다는 과학적 사실이 정책 결정의 기준이 되어야 한다.", weight: -1 }, // 자유주의
                { id: 24, text: "개인의 자유는 사회 질서보다 우선되어야 한다.", weight: -1 }, // 자유주의
                { id: 25, text: "정부는 시민들의 도덕적 행동을 지도할 책임이 있다.", weight: 1 }, // 권위주의
                { id: 26, text: "성소수자들의 권리 보호는 사회 발전의 지표이다.", weight: -1 }, // 자유주의
                { id: 27, text: "테러 방지를 위해서는 강력한 보안 조치가 필요하다.", weight: 1 }, // 권위주의
                { id: 28, text: "개인의 표현의 자유는 다른 사람이 불쾌해하더라도 보장되어야 한다.", weight: -1 } // 자유주의
            ]
        };

        // 모든 질문을 합쳐서 사용
        let allQuestions = [...QUESTIONS_DATA.economic, ...QUESTIONS_DATA.social];
        let currentAnswers = {};

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();
        });



        function loadQuestions() {
            const container = document.getElementById('question-container');
            container.innerHTML = '';
            
            allQuestions.forEach((question, index) => {
                const questionCard = createQuestionCard(question, index);
                container.appendChild(questionCard);
            });
            
            updateProgress();
        }

        function createQuestionCard(question, index) {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <div class="question-text">
                    <strong>${index + 1}.</strong> ${question.text}
                </div>
                <div class="answer-options">
                    <button class="answer-btn" onclick="selectAnswer(${question.id}, -2)" data-value="-2">
                        강하게 반대
                    </button>
                    <button class="answer-btn" onclick="selectAnswer(${question.id}, -1)" data-value="-1">
                        반대
                    </button>
                    <button class="answer-btn" onclick="selectAnswer(${question.id}, 0)" data-value="0">
                        중립
                    </button>
                    <button class="answer-btn" onclick="selectAnswer(${question.id}, 1)" data-value="1">
                        동의
                    </button>
                    <button class="answer-btn" onclick="selectAnswer(${question.id}, 2)" data-value="2">
                        강하게 동의
                    </button>
                </div>
            `;
            return card;
        }

        function selectAnswer(questionId, value) {
            currentAnswers[questionId] = value;
            
            // 선택된 버튼 스타일링
            const questionCard = event.target.closest('.question-card');
            const buttons = questionCard.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            updateProgress();
            checkCompletion();
        }

        function updateProgress() {
            const totalQuestions = allQuestions.length;
            const answeredQuestions = Object.keys(currentAnswers).length;
            const progressPercent = (answeredQuestions / totalQuestions) * 100;
            
            document.getElementById('progress-fill').style.width = progressPercent + '%';
        }

        function checkCompletion() {
            const totalQuestions = allQuestions.length;
            const answeredQuestions = Object.keys(currentAnswers).length;
            
            if (answeredQuestions === totalQuestions) {
                document.getElementById('submit-btn').classList.remove('hidden');
                document.getElementById('submit-btn').disabled = false;
            }
        }

        function calculateResult() {
            let economicScore = 0;
            let socialScore = 0;
            
            // 경제적 점수 계산
            QUESTIONS_DATA.economic.forEach(question => {
                const answer = currentAnswers[question.id];
                if (answer !== undefined) {
                    economicScore += answer * question.weight;
                }
            });
            
            // 사회적 점수 계산
            QUESTIONS_DATA.social.forEach(question => {
                const answer = currentAnswers[question.id];
                if (answer !== undefined) {
                    socialScore += answer * question.weight;
                }
            });
            
            // 점수 정규화 (-10 ~ +10 범위로)
            const normalizedEconomic = Math.max(-10, Math.min(10, economicScore * 0.8)); // 14개 질문 기준 조정
            const normalizedSocial = Math.max(-10, Math.min(10, socialScore * 0.8)); // 14개 질문 기준 조정
            
            showResult(normalizedEconomic, normalizedSocial);
        }

        function showResult(economicScore, socialScore) {
            // 테스트 섹션 숨기기
            document.getElementById('test-section').classList.add('hidden');
            
            // 결과 섹션 보이기
            document.getElementById('result-section').classList.remove('hidden');
            
            // 차트 그리기
            drawCompass(economicScore, socialScore);
            
            // 결과 설명 표시
            showResultDescription(economicScore, socialScore);
        }

        function drawCompass(economicScore, socialScore) {
            const data = [
                // 배경 사분면
                {
                    x: [-10, 0, 0, -10, -10],
                    y: [0, 0, 10, 10, 0],
                    fill: 'toself',
                    fillcolor: 'rgba(255, 99, 99, 0.3)',
                    line: {color: 'rgba(255, 99, 99, 0)'},
                    hoverinfo: 'text',
                    text: '권위주의 좌파<br>Authoritarian Left',
                    showlegend: false,
                    name: 'AuthLeft'
                },
                {
                    x: [0, 10, 10, 0, 0],
                    y: [0, 0, 10, 10, 0],
                    fill: 'toself',
                    fillcolor: 'rgba(99, 99, 255, 0.3)',
                    line: {color: 'rgba(99, 99, 255, 0)'},
                    hoverinfo: 'text',
                    text: '권위주의 우파<br>Authoritarian Right',
                    showlegend: false,
                    name: 'AuthRight'
                },
                {
                    x: [-10, 0, 0, -10, -10],
                    y: [-10, -10, 0, 0, -10],
                    fill: 'toself',
                    fillcolor: 'rgba(99, 255, 99, 0.3)',
                    line: {color: 'rgba(99, 255, 99, 0)'},
                    hoverinfo: 'text',
                    text: '자유주의 좌파<br>Libertarian Left',
                    showlegend: false,
                    name: 'LibLeft'
                },
                {
                    x: [0, 10, 10, 0, 0],
                    y: [-10, -10, 0, 0, -10],
                    fill: 'toself',
                    fillcolor: 'rgba(255, 99, 255, 0.3)',
                    line: {color: 'rgba(255, 99, 255, 0)'},
                    hoverinfo: 'text',
                    text: '자유주의 우파<br>Libertarian Right',
                    showlegend: false,
                    name: 'LibRight'
                },
                // 사용자 위치 점
                {
                    x: [economicScore],
                    y: [socialScore],
                    mode: 'markers',
                    marker: {
                        color: 'red',
                        size: 15,
                        symbol: 'circle',
                        line: {
                            color: 'darkred',
                            width: 2
                        }
                    },
                    name: '당신의 위치',
                    hovertemplate: '<b>당신의 정치적 성향</b><br>' +
                                  '경제: %{x:.1f}<br>' +
                                  '사회: %{y:.1f}<br>' +
                                  '<extra></extra>'
                }
            ];

            const layout = {
                title: {
                    text: '정치적 나침반 (Political Compass)',
                    font: { size: 20, family: 'Noto Sans KR' }
                },
                xaxis: {
                    title: '경제적 성향 ← 좌파 | 우파 →',
                    range: [-10, 10],
                    zeroline: true,
                    zerolinecolor: 'black',
                    zerolinewidth: 2,
                    tickvals: [-10, -5, 0, 5, 10],
                    ticktext: ['극좌', '좌파', '중도', '우파', '극우'],
                    showgrid: true,
                    gridcolor: 'lightgray'
                },
                yaxis: {
                    title: '사회적 성향 ← 자유주의 | 권위주의 →',
                    range: [-10, 10],
                    zeroline: true,
                    zerolinecolor: 'black',
                    zerolinewidth: 2,
                    tickvals: [-10, -5, 0, 5, 10],
                    ticktext: ['극자유', '자유', '중도', '권위', '극권위'],
                    showgrid: true,
                    gridcolor: 'lightgray'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                width: 600,
                height: 600,
                margin: { l: 80, r: 50, t: 100, b: 80 }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            Plotly.newPlot('compass-chart', data, layout, config);
        }

        function showResultDescription(economicScore, socialScore) {
            const quadrant = getQuadrant(economicScore, socialScore);
            const description = getQuadrantDescription(quadrant, economicScore, socialScore);
            
            document.getElementById('result-description').innerHTML = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3 style="color: #495057; margin-bottom: 15px;">${quadrant.name}</h3>
                    <p style="line-height: 1.6; margin-bottom: 15px;">${description}</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <strong>경제적 성향:</strong> ${economicScore.toFixed(1)}<br>
                            <small>${getEconomicLabel(economicScore)}</small>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <strong>사회적 성향:</strong> ${socialScore.toFixed(1)}<br>
                            <small>${getSocialLabel(socialScore)}</small>
                        </div>
                    </div>
                    <button onclick="restartTest()" style="margin-top: 20px; padding: 10px 30px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        다시 테스트하기
                    </button>
                </div>
            `;
        }

        function getQuadrant(economic, social) {
            if (economic < 0 && social > 0) {
                return { name: "권위주의 좌파 (Authoritarian Left)", color: "#ff6363" };
            } else if (economic > 0 && social > 0) {
                return { name: "권위주의 우파 (Authoritarian Right)", color: "#6363ff" };
            } else if (economic < 0 && social < 0) {
                return { name: "자유주의 좌파 (Libertarian Left)", color: "#63ff63" };
            } else {
                return { name: "자유주의 우파 (Libertarian Right)", color: "#ff63ff" };
            }
        }

        function getQuadrantDescription(quadrant, economic, social) {
            const descriptions = {
                "권위주의 좌파 (Authoritarian Left)": "경제적으로는 평등과 사회보장을 중시하지만, 사회적으로는 질서와 통제를 선호하는 성향입니다. 강력한 정부의 역할을 통해 사회적 안정을 추구합니다.",
                "권위주의 우파 (Authoritarian Right)": "경제적으로는 자유시장을 지지하면서도 사회적으로는 전통적 가치와 질서를 중시하는 성향입니다. 강력한 리더십과 사회적 위계질서를 선호합니다.",
                "자유주의 좌파 (Libertarian Left)": "경제적으로는 평등을 추구하면서도 사회적으로는 개인의 자유와 다양성을 중시하는 성향입니다. 사회적 진보와 개인의 자율성을 동시에 추구합니다.",
                "자유주의 우파 (Libertarian Right)": "경제적으로는 자유시장을 지지하고 사회적으로도 개인의 자유를 최우선으로 하는 성향입니다. 정부의 개입을 최소화하고 개인의 선택권을 강조합니다."
            };
            
            return descriptions[quadrant.name] || "중도적 성향을 보이고 있습니다.";
        }

        function getEconomicLabel(score) {
            if (score < -7) return "극좌 성향";
            if (score < -3) return "좌파 성향";
            if (score < -1) return "중도좌파";
            if (score < 1) return "중도";
            if (score < 3) return "중도우파";
            if (score < 7) return "우파 성향";
            return "극우 성향";
        }

        function getSocialLabel(score) {
            if (score < -7) return "극자유주의";
            if (score < -3) return "자유주의";
            if (score < -1) return "중도자유";
            if (score < 1) return "중도";
            if (score < 3) return "중도권위";
            if (score < 7) return "권위주의";
            return "극권위주의";
        }

        function restartTest() {
            currentAnswers = {};
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('test-section').classList.remove('hidden');
            document.getElementById('submit-btn').classList.add('hidden');
            
            // 모든 선택 초기화
            document.querySelectorAll('.answer-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            updateProgress();
        }
    </script>
</body>
</html>